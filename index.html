<html>
  <head>
    <meta charset="utf-8" />
    <title>WebAssembly with Go</title>

    <script src="wasm_exec.js"></script>
    <script>
      const go = new Go();
      WebAssembly.instantiateStreaming(
        fetch("Codebook.wasm"),
        go.importObject
      ).then((result) => {
        go.run(result.instance);

        init();
      });
    </script>
  </head>
  <body>
    <textarea name="script" id="script" cols="30" rows="10"></textarea>

    <div id="res"></div>

    <script>
      async function init() {
        const script = document.getElementById("script");
        const resDiv = document.getElementById("res");

        const vm = wasm_create_vm();

        script.addEventListener("input", (e) => {
          let res = vm.execute(script.value);

          resDiv.innerHTML = res;
        });
      }
    </script>
  </body>
</html>
